<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.delfood.mapper.MenuMapper">

	<resultMap type="menu" id="menuResult">
		<result property="id" column="id"/>
		<result property="name" column="name"/>
		<result property="price" column="price"/>
		<result property="photo" column="photo"/>
		<result property="createdAt" column="created_at"/>
		<result property="updatedAt" column="updated_at"/>
		<result property="status" column="status"/>
		<result property="priority" column="priority"/>
		<result property="contcent" column="contcent"/>
		<result property="menuGroupId" column="menuGroupId"/>
		<collection property="optionList" column="id" javaType="java.util.ArrayList" ofType="menu" select="findOptionbyMenuId"></collection>
	</resultMap>

	<sql id="selectMenu">
		SELECT id, name, price, photo, created_at createdAt,
		updated_at updatedAt, status, priority, content, menuGroupId
		FROM MENU
	</sql>
	
	<insert id="insertMenu" parameterType="menu">
		INSERT INTO(name, price, photo, priority, content, menu_group_id)
		VALUES(#{name}, #{price}, #{photo}, #{priority}, #{content}, #{menuGroupId})
		<selectKey resultType="long" keyProperty="id" order="AFTER">
        SELECT LAST_INSERT_ID()
    	</selectKey> 
	</insert>
	
	<update id="deleteMenu">
		UPDATE MENU
		SET status = "DELETE"
		WHERE id = #{id}
	</update>
	
	<select id="checkMenu">
		SELECT COUNT(id)
		FROM MENU
		WHERE menu_Group_id = #{menuGroupId}
		AND id = #{menuId}
	</select>
	
	<update id="updateMenuPriority">
		UPDATE MENU
		SET priority = #{priority}
		WHERE id = #{id}
	</update>
	
	<update id="updateMenu" parameterType="menu">
		UPDATE MENU
		SET name = #{name},
		price = #{price},
		photo = #{photo},
		content = #{content}
		WHERE id = #{id}
	</update>

	<select id="findById">
		SELECT id, name, price, photo, content
	</select>
	
	<select id="findOptionbyMenuId">
		SELECT id, name, price, status, menu_id menuId
		FROM OPTION
		WHERE id = #{id}
	</select>
	
</mapper>